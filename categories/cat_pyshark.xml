<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Packet Capture (Posts about PyShark)</title><link>https://github.com/necromuralist/packet_capture/</link><description></description><atom:link href="https://github.com/necromuralist/packet_capture/categories/cat_pyshark.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents © 2018 &lt;a href="mailto:necromuralist@protonmail.com"&gt;necromuralist&lt;/a&gt; </copyright><lastBuildDate>Fri, 31 Aug 2018 02:46:03 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>PyShark Test</title><link>https://github.com/necromuralist/packet_capture/posts/pyshark-test/</link><dc:creator>necromuralist</dc:creator><description>&lt;div id="outline-container-orgb644a3d" class="outline-2"&gt;
&lt;h2 id="orgb644a3d"&gt;Introduction&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgb644a3d"&gt;
&lt;p&gt;
This is a first look at &lt;a href="https://github.com/KimiNewt/pyshark"&gt;pyshark&lt;/a&gt;. Since I'm mostly interested in WiFi I'm going to look at that here. Before this code is run I put it in &lt;a href="https://en.wikipedia.org/wiki/Monitor_mode"&gt;monitor mode&lt;/a&gt; using &lt;a href="https://www.aircrack-ng.org/doku.php?id=airmon-ng"&gt;airmon-ng&lt;/a&gt; a shell-script to help you do this. The interface says that tshark should be able to put it into monitor mode but it didn't work when I tried it, but this is the first time I've tried it so I might have missed something.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id="outline-container-orgb96bea6" class="outline-2"&gt;
&lt;h2 id="orgb96bea6"&gt;Imports&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgb96bea6"&gt;
/home/brunhilde/.virtualenvs/alpaca/bin/python: No module named virtualfish
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pyshark&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-orgb0fcc6b" class="outline-2"&gt;
&lt;h2 id="orgb0fcc6b"&gt;Contents&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgb0fcc6b"&gt;
/home/brunhilde/.virtualenvs/alpaca/bin/python: No module named virtualfish
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;INTERFACE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"wlx00c0ca967adc"&lt;/span&gt;
&lt;span class="n"&gt;README_OUT&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"/tmp/readme.pcapng"&lt;/span&gt;
&lt;span class="n"&gt;MOTOROLA&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"d0:04:01:6d:c1:a7"&lt;/span&gt;
&lt;span class="n"&gt;ASUS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"1c:b7:2c:86:be:d0"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org36f369c" class="outline-2"&gt;
&lt;h2 id="org36f369c"&gt;The Readme Example&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org36f369c"&gt;
&lt;p&gt;
This first example is taken from the &lt;a href="https://github.com/KimiNewt/pyshark"&gt;repository&lt;/a&gt; README file.
&lt;/p&gt;
&lt;/div&gt;
&lt;div id="outline-container-orgd34564f" class="outline-3"&gt;
&lt;h3 id="orgd34564f"&gt;Readme Tangle&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-orgd34564f"&gt;
&lt;p&gt;
It turns out that there's some kind of conflict with ob-ipython and pyshark, so to run it I have to tangle it outside of my file and run it, so this is going to be a noweb type of thing.
&lt;/p&gt;
/home/brunhilde/.virtualenvs/alpaca/bin/python: No module named virtualfish
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;imports&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;

&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;constants&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;

&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;load&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;file&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;

&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;packet&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;

&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;motorola&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;packets&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org445530b" class="outline-3"&gt;
&lt;h3 id="org445530b"&gt;Reading the Packets&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org445530b"&gt;
&lt;p&gt;
I'm going to start with the live capture. I don't know if this is as fast as using the binary, but maybe it's good enough for this.
&lt;/p&gt;
/home/brunhilde/.virtualenvs/alpaca/bin/python: No module named virtualfish
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;capture = pyshark.LiveCapture(interface=INTERFACE, output_file=README_OUT)
capture.sniff(timeout=60)
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
This gave me an error:
&lt;/p&gt;

&lt;pre class="example"&gt;
RuntimeErrorTraceback (most recent call last)
&amp;lt;ipython-input-4-44ea834109e1&amp;gt; in &amp;lt;module&amp;gt;()
      1 capture = pyshark.LiveCapture(interface=INTERFACE, output_file=README_OUT)
----&amp;gt; 2 capture.sniff(timeout=60)

~/.virtualenvs/alpaca/lib/python3.6/site-packages/pyshark/capture/capture.py in load_packets(self, packet_count, timeout)
    130 
    131         try:
--&amp;gt; 132             self.apply_on_packets(keep_packet, timeout=timeout)
    133             self.loaded = True
    134         except TimeoutError:

~/.virtualenvs/alpaca/lib/python3.6/site-packages/pyshark/capture/capture.py in apply_on_packets(self, callback, timeout, packet_count)
    245         if timeout is not None:
    246             coro = asyncio.wait_for(coro, timeout)
--&amp;gt; 247         return self.eventloop.run_until_complete(coro)
    248 
    249     async def packets_from_tshark(self, packet_callback, packet_count=None, close_tshark=True):

/usr/lib/python3.6/asyncio/base_events.py in run_until_complete(self, future)
    453         future.add_done_callback(_run_until_complete_cb)
    454         try:
--&amp;gt; 455             self.run_forever()
    456         except:
    457             if new_task and future.done() and not future.cancelled():

/usr/lib/python3.6/asyncio/base_events.py in run_forever(self)
    410         if events._get_running_loop() is not None:
    411             raise RuntimeError(
--&amp;gt; 412                 'Cannot run the event loop while another loop is running')
    413         self._set_coroutine_wrapper(self._debug)
    414         self._thread_id = threading.get_ident()

RuntimeError: Cannot run the event loop while another loop is running
&lt;/pre&gt;

&lt;p&gt;
So I ran dumpcap at the command-line to get the file instead.
&lt;/p&gt;

&lt;pre class="example"&gt;
dumpcap -i $WLAN /tmp/readme.pcapng -a duration:60
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org636426e" class="outline-3"&gt;
&lt;h3 id="org636426e"&gt;Inspecting the Packets&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org636426e"&gt;
/home/brunhilde/.virtualenvs/alpaca/bin/python: No module named virtualfish
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;capture&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pyshark&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;FileCapture&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;README_OUT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;display_filter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"wlan.addr=={} and wlan.addr=={}"&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MOTOROLA&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ASUS&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
Here's the first packet.
&lt;/p&gt;

/home/brunhilde/.virtualenvs/alpaca/bin/python: No module named virtualfish
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;capture&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

/home/brunhilde/.virtualenvs/alpaca/bin/python: No module named virtualfish
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;. ~/.virtualenvs/alpaca/
python /tmp/readme_1.py
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;
Packet (Length: 44)
Layer RADIOTAP:
	Header revision: 0
	Header pad: 0
	Header length: 18
	Present flags
	Present flags word: 0x0000482e
	…. …. …. …. …. …. …. …0 = TSFT: Absent
	…. …. …. …. …. …. …. ..1. = Flags: Present
	…. …. …. …. …. …. …. .1.. = Rate: Present
	…. …. …. …. …. …. …. 1… = Channel: Present
	…. …. …. …. …. …. …0 …. = FHSS: Absent
	…. …. …. …. …. …. ..1. …. = dBm Antenna Signal: Present
	…. …. …. …. …. …. .0.. …. = dBm Antenna Noise: Absent
	…. …. …. …. …. …. 0… …. = Lock Quality: Absent
	…. …. …. …. …. …0 …. …. = TX Attenuation: Absent
	…. …. …. …. …. ..0. …. …. = dB TX Attenuation: Absent
	…. …. …. …. …. .0.. …. …. = dBm TX Power: Absent
	…. …. …. …. …. 1… …. …. = Antenna: Present
	…. …. …. …. …0 …. …. …. = dB Antenna Signal: Absent
	…. …. …. …. ..0. …. …. …. = dB Antenna Noise: Absent
	…. …. …. …. .1.. …. …. …. = RX flags: Present
	…. …. …. .0.. …. …. …. …. = Channel+: Absent
	…. …. …. 0… …. …. …. …. = MCS information: Absent
	…. …. …0 …. …. …. …. …. = A-MPDU Status: Absent
	…. …. ..0. …. …. …. …. …. = VHT information: Absent
	…. …. .0.. …. …. …. …. …. = frame timestamp: Absent
	…. …. 0… …. …. …. …. …. = HE information: Absent
	…. …0 …. …. …. …. …. …. = HE-MU information: Absent
	…0 000. …. …. …. …. …. …. = Reserved: 0x0
	..0. …. …. …. …. …. …. …. = Radiotap NS next: False
	.0.. …. …. …. …. …. …. …. = Vendor NS next: False
	0… …. …. …. …. …. …. …. = Ext: Absent
	Flags: 0x00
	…. …0 = CFP: False
	…. ..0. = Preamble: Long
	…. .0.. = WEP: False
	…. 0… = Fragmentation: False
	…0 …. = FCS at end: False
	..0. …. = Data Pad: False
	.0.. …. = Bad FCS: False
	0… …. = Short GI: False
	Data Rate: 1.0 Mb/s
	Channel frequency: 2412 [BG 1]
	Channel flags: 0x00a0, Complementary Code Keying (CCK), 2 GHz spectrum
	…. …. …0 …. = Turbo: False
	…. …. ..1. …. = Complementary Code Keying (CCK): True
	…. …. .0.. …. = Orthogonal Frequency-Division Multiplexing (OFDM): False
	…. …. 1… …. = 2 GHz spectrum: True
	…. …0 …. …. = 5 GHz spectrum: False
	…. ..0. …. …. = Passive: False
	…. .0.. …. …. = Dynamic CCK-OFDM: False
	…. 0… …. …. = Gaussian Frequency Shift Keying (GFSK): False
	…0 …. …. …. = GSM (900MHz): False
	..0. …. …. …. = Static Turbo: False
	.0.. …. …. …. = Half Rate Channel (10MHz Channel Width): False
	0… …. …. …. = Quarter Rate Channel (5MHz Channel Width): False
	Antenna signal: -28dBm
	Antenna: 0
	RX flags: 0x0000
	…. …. …. …. …. ..0. = Bad PLCP: False
Layer WLAN&lt;sub&gt;RADIO&lt;/sub&gt;:
	PHY type: 802.11b (4)
	Short preamble: False
	Data rate: 1.0 Mb/s
	Channel: 1
	Frequency: 2412MHz
	Signal strength (dBm): -28dBm
	Duration: 400\xc2\xb5s
	Preamble: 192\xc2\xb5s
Layer WLAN:
	Type/Subtype: QoS Null function (No data) (0x002c)
	Frame Control Field: 0xc811
	…. ..00 = Version: 0
	…. 10.. = Type: Data frame (2)
	1100 …. = Subtype: 12
	Flags: 0x11
	…. ..01 = DS status: Frame from STA to DS via an AP (To DS: 1 From DS: 0) (0x1)
	…. .0.. = More Fragments: This is the last fragment
	…. 0… = Retry: Frame is not being retransmitted
	…1 …. = PWR MGT: STA will go to sleep
	..0. …. = More Data: No data buffered
	.0.. …. = Protected flag: Data is not protected
	0… …. = Order flag: Not strictly ordered
	.000 0001 0011 1010 = Duration: 314 microseconds
	Receiver address: 1c:b7:2c:86:be:d0
	Transmitter address: d0:04:01:6d:c1:a7
	Destination address: 1c:b7:2c:86:be:d0
	Source address: d0:04:01:6d:c1:a7
	BSS Id: 1c:b7:2c:86:be:d0
	STA address: d0:04:01:6d:c1:a7
	…. …. …. 0000 = Fragment number: 0
	0100 0011 0010 …. = Sequence number: 1074
	Qos Control: 0x0001
	…. …. …. 0001 = TID: 1
	…. …. …. .001 = Priority: Background (Background) (1)
	…. …. …0 …. = QoS bit 4: Bits 8-15 of QoS Control field are TXOP Duration Requested
	…. …. .00. …. = Ack Policy: Normal Ack (0x0)
	0000 0000 …. …. = TXOP Duration Requested: 0 (no TXOP requested)
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description><category>pyshark python experiment notes</category><guid>https://github.com/necromuralist/packet_capture/posts/pyshark-test/</guid><pubDate>Thu, 30 Aug 2018 20:40:58 GMT</pubDate></item></channel></rss>